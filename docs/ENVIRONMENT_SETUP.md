# Environment Setup Guide

This guide will help you set up the environment configuration for the Fortisel Backend API.

## üöÄ Quick Setup

### 1. Run the Setup Script

```bash
# Make the setup script executable
chmod +x scripts/setup-env.js

# Run the setup script
node scripts/setup-env.js
```

This script will:
- Create a `.env` file from `env.example`
- Generate secure JWT and session secrets
- Set up basic configuration

### 2. Manual Setup

If you prefer manual setup:

```bash
# Copy the example environment file
cp env.example .env

# Edit the .env file with your actual values
nano .env
```

## üìã Required Environment Variables

### Critical (Must be set)

| Variable | Description | Example |
|----------|-------------|---------|
| `MONGODB_URI` | MongoDB connection string | `mongodb://localhost:27017/fortisel` |
| `JWT_SECRET` | JWT signing secret (min 32 chars) | Generated by setup script |

### Database Configuration

| Variable | Description | Default |
|----------|-------------|---------|
| `MONGODB_MAX_POOL_SIZE` | Maximum connection pool size | `10` |
| `MONGODB_SERVER_SELECTION_TIMEOUT_MS` | Server selection timeout | `5000` |
| `MONGODB_SOCKET_TIMEOUT_MS` | Socket timeout | `45000` |

### Application Configuration

| Variable | Description | Default |
|----------|-------------|---------|
| `NODE_ENV` | Environment (development/production) | `development` |
| `PORT` | Server port | `3000` |
| `API_PREFIX` | API route prefix | `api` |

### CORS Configuration

| Variable | Description | Default |
|----------|-------------|---------|
| `CORS_ORIGINS` | Allowed origins (comma-separated) | `http://localhost:3000,http://localhost:8081,http://localhost:19006` |

### JWT Configuration

| Variable | Description | Default |
|----------|-------------|---------|
| `JWT_SECRET` | JWT signing secret | Generated by setup script |
| `JWT_EXPIRES_IN` | Token expiration time | `24h` |
| `JWT_REFRESH_EXPIRES_IN` | Refresh token expiration | `7d` |

## üîß Service Configurations

### Payment Providers

#### Paystack
```env
PAYSTACK_SECRET_KEY=sk_test_your_paystack_secret_key
PAYSTACK_PUBLIC_KEY=pk_test_your_paystack_public_key
PAYSTACK_WEBHOOK_SECRET=your_paystack_webhook_secret
```

#### MoMo
```env
MOMO_API_KEY=your_momo_api_key
MOMO_WEBHOOK_SECRET=your_momo_webhook_secret
```

### Google OAuth
```env
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
GOOGLE_CALLBACK_URL=http://localhost:3000/api/users/auth/google/callback
```

### Email Service (SMTP)
```env
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
SMTP_FROM=noreply@fortisel.com
```

### SMS Service (Twilio)
```env
TWILIO_ACCOUNT_SID=your_twilio_account_sid
TWILIO_AUTH_TOKEN=your_twilio_auth_token
TWILIO_PHONE_NUMBER=+1234567890
```

## üîê Security Best Practices

### 1. Secret Generation

Generate strong secrets using:

```bash
# JWT Secret (64 bytes base64)
openssl rand -base64 64

# Session Secret (32 bytes hex)
openssl rand -hex 32
```

### 2. Environment-Specific Configuration

Create separate `.env` files for different environments:

```bash
# Development
.env.development

# Production
.env.production

# Testing
.env.test
```

### 3. Production Security

For production environments:

- Use environment-specific secrets
- Enable SSL/TLS
- Use strong database passwords
- Implement rate limiting
- Enable security headers
- Use secrets management services

## üö® Common Issues

### 1. Missing Environment Variables

If you see errors about missing environment variables:

```bash
# Check if .env file exists
ls -la .env

# Verify environment variables are loaded
node -e "require('dotenv').config(); console.log(process.env.MONGODB_URI)"
```

### 2. Database Connection Issues

```bash
# Test MongoDB connection
mongosh "your-connection-string"

# Check if MongoDB is running
sudo systemctl status mongod
```

### 3. JWT Secret Issues

Ensure JWT secret is at least 32 characters:

```bash
# Check JWT secret length
node -e "console.log(process.env.JWT_SECRET?.length)"
```

## üìù Environment Validation

The application validates required environment variables on startup. Missing variables will cause the application to fail with descriptive error messages.

### Required Variables
- `MONGODB_URI`
- `JWT_SECRET`

### Validation Rules
- JWT_SECRET must be at least 32 characters
- MONGODB_URI must be a valid MongoDB connection string
- PORT must be a valid number

## üîÑ Environment Switching

### Development
```bash
NODE_ENV=development npm run start:dev
```

### Production
```bash
NODE_ENV=production npm run start:prod
```

### Testing
```bash
NODE_ENV=test npm run test
```

## üìö Additional Resources

- [NestJS Configuration](https://docs.nestjs.com/techniques/configuration)
- [MongoDB Connection Strings](https://docs.mongodb.com/manual/reference/connection-string/)
- [JWT Best Practices](https://auth0.com/blog/a-look-at-the-latest-draft-for-jwt-bcp/)
- [Environment Variables Security](https://12factor.net/config)

## üÜò Support

If you encounter issues:

1. Check the application logs
2. Verify environment variables are set correctly
3. Ensure all required services are running
4. Review the security checklist

For additional help, refer to the main README.md file.
